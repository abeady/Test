<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„</title>
<style>
  :root{
    --bg:#f4f7f6;
    --accent:#4a6fa5;
    --cardBack:#cfe3dc;
    --cardFront:#ffffff;
    --text:#2b3a44;
    --good:#2e7d32;
    --bad:#c62828;
    --gap:12px;
    --cardSize:92px; /* Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ */
  }

  *{ box-sizing:border-box; }

  body{
    font-family: Arial, sans-serif;
    background: var(--bg);
    margin:0;
    padding: 16px 14px 28px;
    text-align:center;
    color:var(--text);
  }

  h1{ color:var(--accent); margin: 6px 0 4px; font-size: 28px; }
  .sub{ margin: 6px 0 14px; opacity:0.9; }

  .panel{
    max-width: 720px;
    margin: 0 auto 10px;
    padding: 12px;
    border-radius: 14px;
    background: rgba(255,255,255,0.75);
    box-shadow: 0 1px 8px rgba(0,0,0,0.06);
  }

  .row{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:center;
    align-items:center;
    margin: 8px 0;
  }

  label{
    font-size: 15px;
    opacity: 0.9;
  }

  select, button{
    font-size: 16px;
    border-radius: 10px;
    border: 1px solid rgba(0,0,0,0.08);
    padding: 10px 12px;
    background: #fff;
  }

  button{
    border:none;
    cursor:pointer;
    background: var(--cardBack);
    padding: 10px 14px;
  }

  .topbar{
    max-width: 720px;
    margin: 0 auto 10px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding: 10px 12px;
    border-radius: 14px;
    background: rgba(255,255,255,0.75);
    box-shadow: 0 1px 8px rgba(0,0,0,0.06);
  }

  .score{
    font-size: 18px;
    font-weight: 700;
    color: var(--accent);
    display:flex;
    align-items:center;
    gap:8px;
  }
  .score span{
    display:inline-block;
    min-width: 60px;
    text-align:center;
    padding: 6px 10px;
    border-radius: 10px;
    background: #e9f0ff;
    color: var(--accent);
  }

  .game{
    width: 100%;
    max-width: 720px;
    margin: 8px auto 6px;
    display:grid;
    gap: var(--gap);
    padding: 10px;
  }

  /* Card with flip animation */
  .card{
    height: var(--cardSize);
    perspective: 900px;
  }
  .cardInner{
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 420ms ease;
    border-radius: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.07);
  }
  .card.flipped .cardInner{ transform: rotateY(180deg); }

  .cardFace{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius: 14px;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    user-select:none;
  }
  .cardBack{
    background: var(--cardBack);
    font-size: calc(var(--cardSize) * 0.40);
  }
  .cardFront{
    background: var(--cardFront);
    transform: rotateY(180deg);
    font-size: calc(var(--cardSize) * 0.44);
  }

  .message{
    max-width: 720px;
    margin: 8px auto 0;
    font-size: 18px;
    min-height: 24px;
  }
  .message.good{ color: var(--good); }
  .message.bad{ color: var(--bad); }

  .hint{
    font-size: 13px;
    opacity: 0.78;
    margin-top: 6px;
  }

  .footerNote{
    font-size: 12px;
    opacity: 0.65;
    margin-top: 14px;
  }
</style>
</head>
<body>

<h1>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© ğŸŒ¸</h1>
<div class="sub">Ø§Ø®ØªØ§Ø±ÙŠ Ù†ÙˆØ¹ Ø§Ù„ØµÙˆØ± ÙˆÙ…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©ØŒ Ø«Ù… Ø§Ø¨Ø¯Ø¦ÙŠ Ø§Ù„Ù„Ø¹Ø¨</div>

<div class="panel" id="setupPanel">
  <div class="row">
    <label for="category">Ù†ÙˆØ¹ Ø§Ù„ØµÙˆØ±:</label>
    <select id="category">
      <option value="fruits">ğŸ ÙÙˆØ§ÙƒÙ‡</option>
      <option value="emoji">ğŸ˜Š Ø¥ÙŠÙ…ÙˆØ¬ÙŠ</option>
      <option value="cartoon">ğŸ§¸ Ø´Ø®ØµÙŠØ§Øª ÙƒØ±ØªÙˆÙ†ÙŠØ© (Ø±Ù…ÙˆØ² Ù„Ø·ÙŠÙØ©)</option>
      <option value="random">ğŸ² Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</option>
      <option value="flags">ğŸ³ï¸ Ø£Ø¹Ù„Ø§Ù… Ø¯ÙˆÙ„</option>
      <option value="numbers">ğŸ”¢ Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
      <option value="arabicLetters">ğŸ”¤ Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© (Ø§Ù‚ØªØ±Ø§Ø­)</option>
    </select>

    <label for="difficulty">Ø§Ù„ØµØ¹ÙˆØ¨Ø©:</label>
    <select id="difficulty">
      <option value="easy">Ø³Ù‡Ù„ (8 Ù…Ø±Ø¨Ø¹Ø§Øª)</option>
      <option value="medium">Ù…ØªÙˆØ³Ø· (12 Ù…Ø±Ø¨Ø¹)</option>
      <option value="hard">ØµØ¹Ø¨ (16 Ù…Ø±Ø¨Ø¹)</option>
    </select>
  </div>

  <div class="row">
    <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ â–¶ï¸</button>
    <button id="shuffleBtn" title="ØºÙŠÙ‘Ø± ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙˆØ±">ØªØºÙŠÙŠØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠ ğŸ”„</button>
  </div>

  <div class="hint">Ø§Ù„Ù†Ù‚Ø§Ø·: +10 Ø¹Ù†Ø¯ Ø§Ù„ØªØ·Ø§Ø¨Ù‚ âœ… | -10 Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£ âŒ</div>
</div>

<div class="topbar">
  <div class="score">â­ Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
  <div class="row" style="margin:0; gap:8px;">
    <button id="restartBtn">Ø¥Ø¹Ø§Ø¯Ø©</button>
  </div>
</div>

<div class="game" id="game"></div>
<div class="message" id="message"></div>
<div class="footerNote">ØªÙ„Ù…ÙŠØ­: Ø¬Ø±Ù‘Ø¨ÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¢ÙŠØ¨Ø§Ø¯ Ù„Ø¹Ø±Ø¶ Ø£Ø¬Ù…Ù„ ğŸ’›</div>

<script>
/* ========= Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ù…ÙˆØ² ========= */
const POOLS = {
  fruits: ["ğŸ","ğŸ","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ«","ğŸ’","ğŸ¥­","ğŸ","ğŸ¥","ğŸ‘","ğŸˆ","ğŸ¥¥"],
  emoji: ["ğŸ˜Š","ğŸ˜‚","ğŸ˜","ğŸ˜","ğŸ¤©","ğŸ¥³","ğŸ˜´","ğŸ¤”","ğŸ˜‡","ğŸ˜º","ğŸ™ƒ","ğŸ˜œ","ğŸ¤—","ğŸ˜®","ğŸ˜¡","ğŸ˜­"],
  cartoon: ["ğŸ±","ğŸ¶","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸ¨","ğŸ¯","ğŸ¦","ğŸ¸","ğŸµ","ğŸ·","ğŸ¦„","ğŸ™","ğŸ§","ğŸ§š"],
  flags: ["ğŸ‡¸ğŸ‡¦","ğŸ‡¦ğŸ‡ª","ğŸ‡¶ğŸ‡¦","ğŸ‡°ğŸ‡¼","ğŸ‡§ğŸ‡­","ğŸ‡´ğŸ‡²","ğŸ‡¯ğŸ‡´","ğŸ‡ªğŸ‡¬","ğŸ‡²ğŸ‡¦","ğŸ‡¹ğŸ‡³","ğŸ‡©ğŸ‡¿","ğŸ‡¹ğŸ‡·","ğŸ‡¬ğŸ‡§","ğŸ‡«ğŸ‡·","ğŸ‡©ğŸ‡ª","ğŸ‡ºğŸ‡¸"],
  numbers: ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],
  arabicLetters: ["Ø£","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø®","Ø¯","Ø°","Ø±","Ø²","Ø³","Ø´","Øµ","Ø¶","Ø·","Ø¸","Ø¹","Øº","Ù","Ù‚","Ùƒ","Ù„","Ù…","Ù†","Ù‡Ù€","Ùˆ","ÙŠ"]
};

function getPool(category){
  if(category === "random"){
    // Ø¯Ù…Ø¬ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø®ØªØ§Ø±Ø© Ø­ØªÙ‰ ØªÙƒÙˆÙ† Ù„Ø·ÙŠÙØ© ÙˆÙ…ØªÙ†ÙˆØ¹Ø©
    const mix = []
      .concat(POOLS.fruits.slice(0,12))
      .concat(POOLS.emoji.slice(0,12))
      .concat(POOLS.cartoon.slice(0,12))
      .concat(POOLS.flags.slice(0,12))
      .concat(POOLS.numbers.slice(0,12))
      .concat(POOLS.arabicLetters.slice(0,12));
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¥Ù† ÙˆØ¬Ø¯ (Ø§Ø­ØªÙŠØ§Ø·)
    return [...new Set(mix)];
  }
  return POOLS[category] || POOLS.fruits;
}

const DIFFICULTY = {
  easy: 8,    // 4 Ø£Ø²ÙˆØ§Ø¬
  medium: 12, // 6 Ø£Ø²ÙˆØ§Ø¬
  hard: 16    // 8 Ø£Ø²ÙˆØ§Ø¬
};

/* ========= Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ========= */
let first = null;
let lock = false;
let matches = 0;
let score = 0;
let totalCards = 0;
let currentDeck = [];
let currentCategory = "fruits";
let currentDifficulty = "easy";

const gameEl = document.getElementById("game");
const msgEl = document.getElementById("message");
const scoreEl = document.getElementById("score");

/* ========= Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ========= */
function shuffle(arr){
  const a = [...arr];
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function setMessage(text, kind=null){
  msgEl.className = "message" + (kind ? " " + kind : "");
  msgEl.textContent = text || "";
}

function setScore(val){
  score = Math.max(0, val);
  scoreEl.textContent = score;
}

/* ========= ØªØ®Ø·ÙŠØ· Ø§Ù„Ø´Ø¨ÙƒØ© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ========= */
function computeGrid(n){
  // Ù†Ø¬Ø±Ù‘Ø¨ Ø¹Ø¯Ø¯ Ø£Ø¹Ù…Ø¯Ø© Ù…Ø®ØªÙ„Ù ÙˆÙ†Ø®ØªØ§Ø± Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø±Ø¨Ø¹Ø©
  const gap = 12;
  const w = Math.min(window.innerWidth - 28, 720); // Ø¹Ø±Ø¶ Ù…Ù†Ø§Ø³Ø¨
  const h = Math.max(360, window.innerHeight - 320); // Ù…Ø³Ø§Ø­Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø´Ø¨ÙƒØ©
  let best = {cols:4, rows: Math.ceil(n/4), size: 84, score: 1e9};

  for(let cols=2; cols<=6; cols++){
    const rows = Math.ceil(n/cols);
    const cellW = (w - gap*(cols-1) - 20) / cols;
    const cellH = (h - gap*(rows-1) - 20) / rows;
    const size = Math.floor(Math.max(58, Math.min(cellW, cellH))); // Ù„Ø§ ØªÙƒÙˆÙ† ØµØºÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§
    const ratio = cellW / cellH;
    const ratioScore = Math.abs(1 - ratio); // Ù†Ø±ÙŠØ¯ Ù‚Ø±ÙŠØ¨ Ù…Ù† 1
    const sizePenalty = size < 64 ? 0.25 : 0; // ØªØ¬Ù†Ù‘Ø¨ Ø§Ù„ØµØºØ±
    const score = ratioScore + sizePenalty + (cols>4 ? 0.05 : 0); // ØªÙØ¶ÙŠÙ„ Ø£Ø¹Ù…Ø¯Ø© Ø£Ù‚Ù„ Ù‚Ù„ÙŠÙ„Ù‹Ø§
    if(score < best.score){
      best = {cols, rows, size, score};
    }
  }
  return best;
}

function applyGrid(n){
  const g = computeGrid(n);
  gameEl.style.gridTemplateColumns = `repeat(${g.cols}, 1fr)`;
  document.documentElement.style.setProperty("--cardSize", `${g.size}px`);
}

/* ========= Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© ========= */
function buildDeck(category, difficulty){
  const n = DIFFICULTY[difficulty] || 8;
  const pairs = n / 2;

  const pool = getPool(category);
  const picked = shuffle(pool).slice(0, pairs);
  const deck = shuffle(picked.concat(picked)); // Ø²ÙˆØ¬ÙŠÙ†
  return { deck, n };
}

function renderBoard(deck){
  gameEl.innerHTML = "";
  deck.forEach(sym => {
    const card = document.createElement("div");
    card.className = "card";
    card.dataset.symbol = sym;

    const inner = document.createElement("div");
    inner.className = "cardInner";

    const back = document.createElement("div");
    back.className = "cardFace cardBack";
    back.textContent = "â“";

    const front = document.createElement("div");
    front.className = "cardFace cardFront";
    front.textContent = sym;

    inner.appendChild(back);
    inner.appendChild(front);
    card.appendChild(inner);

    card.addEventListener("click", () => handleFlip(card));
    gameEl.appendChild(card);
  });
}

function startGame(){
  first = null;
  lock = false;
  matches = 0;
  setScore(0);
  setMessage("");

  const { deck, n } = buildDeck(currentCategory, currentDifficulty);
  currentDeck = deck;
  totalCards = n;

  applyGrid(totalCards);
  renderBoard(currentDeck);
}

/* ========= Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨ + Ø§Ù„Ù†Ù‚Ø§Ø· ========= */
function handleFlip(card){
  if (lock || card.classList.contains("matched") || card.classList.contains("flipped")) return;

  card.classList.add("flipped");

  if(!first){
    first = card;
    return;
  }

  const second = card;

  if(first.dataset.symbol === second.dataset.symbol){
    first.classList.add("matched");
    second.classList.add("matched");
    first = null;
    matches++;
    setScore(score + 10);
    setMessage("Ù…Ù…ØªØ§Ø²! âœ… +10", "good");

    if(matches === totalCards / 2){
      setMessage(`Ø´Ø·ÙˆØ±Ø±Ø±Ø©! ğŸ‰ Ø®Ù„ØµØªÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©! Ù…Ø¬Ù…ÙˆØ¹Ùƒ: ${score}`, "good");
    }
  } else {
    lock = true;
    setScore(score - 10);
    setMessage("Ù‚Ø±ÙŠØ¨! âŒ -10 Ø¬Ø±Ù‘Ø¨ÙŠ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©", "bad");

    setTimeout(() => {
      first.classList.remove("flipped");
      second.classList.remove("flipped");
      first = null;
      lock = false;
      setMessage("");
    }, 900);
  }
}

/* ========= Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± ========= */
const categoryEl = document.getElementById("category");
const difficultyEl = document.getElementById("difficulty");

document.getElementById("startBtn").addEventListener("click", () => {
  currentCategory = categoryEl.value;
  currentDifficulty = difficultyEl.value;
  startGame();
});

document.getElementById("shuffleBtn").addEventListener("click", () => {
  // ÙÙ‚Ø· ÙŠØºÙŠÙ‘Ø± Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ù†ÙØ³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  currentCategory = categoryEl.value;
  currentDifficulty = difficultyEl.value;
  startGame();
});

document.getElementById("restartBtn").addEventListener("click", () => {
  if(!currentDeck.length){
    currentCategory = categoryEl.value;
    currentDifficulty = difficultyEl.value;
  }
  startGame();
});

/* Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ØªØ®Ø·ÙŠØ· Ø¹Ù†Ø¯ Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
window.addEventListener("resize", () => {
  if(totalCards){
    applyGrid(totalCards);
  }
});

/* ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) */
setMessage("Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø«Ù… Ø§Ø¶ØºØ·ÙŠ: Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ â–¶ï¸");
</script>

</body>
</html>
